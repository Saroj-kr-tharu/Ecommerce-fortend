<!-- PrimeNG Table-based admin products page (in-memory)
     Replaced PrimeNG p-dropdown with native <select> using FormsModule/ngModel -->

<div class="card mt-40">
    <p-toolbar styleClass="mb-4">
        <div class="p-toolbar-group-left">
            <button pButton type="button" label="New" icon="pi pi-plus" class="p-button-success p-mr-2"
                (click)="openNew()"></button>
            <button pButton type="button" label="Delete" icon="pi pi-trash" class="p-button-danger"
                (click)="deleteSelectedProducts()" [disabled]="!selectedProducts || !selectedProducts.length"></button>
        </div>
        <div class="p-toolbar-group-right">
            <button pButton type="button" icon="pi pi-file" label="Export" class="p-button-outlined"
                (click)="exportCSV()"></button>
        </div>
    </p-toolbar>

    <p-table #dt [value]="products" selectionMode="multiple" [(selection)]="selectedProducts" dataKey="id"
        [paginator]="true" [rows]="10" [rowsPerPageOptions]="[5,10,20]" [responsiveLayout]="'scroll'">
        <ng-template pTemplate="header">
            <tr>
                <th style="width: 3rem">
                    <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
                </th>
                <th *ngFor="let col of cols" [pSortableColumn]="col.field">
                    {{ col.header }}
                    <p-sortIcon [field]="col.field"></p-sortIcon>
                </th>
                <th>Status</th>
                <th style="width: 12rem">Actions</th>
            </tr>
            <tr>
                <th></th>
                <th *ngFor="let col of cols">
                    <input pInputText type="text" (input)="dt.filter($event.target.value, col.field, 'contains')"
                        placeholder="Search {{col.header}}" style="width:100%" />
                </th>
                <th>
                    <!-- Native select used for filtering status -->
                    <select class="p-inputtext" (change)="dt.filter($event.target, 'status', 'equals')">
                        <option value="">All</option>
                        <option *ngFor="let s of statuses" [value]="s.value">{{ s.label }}</option>
                    </select>
                </th>
                <th></th>
            </tr>
        </ng-template>

        <ng-template pTemplate="body" let-rowData>
            <tr>
                <td>
                    <p-tableCheckbox [value]="rowData"></p-tableCheckbox>
                </td>

                <td>{{ rowData.code }}</td>
                <td>
                    <div class="product-name">
                        <img *ngIf="rowData.image" [src]="rowData.image" alt="thumb" class="thumb" />
                        <div class="p-ml-2">{{ rowData.name }}</div>
                    </div>
                </td>
                <td>{{ rowData.category }}</td>
                <td>Rs. {{ rowData.price | number:'1.0-0' }}</td>

                <td>
                    <p-tag [value]="rowData.status" [severity]="getSeverity(rowData.status)"></p-tag>
                </td>

                <td>
                    <button pButton type="button" icon="pi pi-pencil" class="p-button-rounded p-button-text p-mr-2"
                        (click)="editProduct(rowData)"></button>
                    <button pButton type="button" icon="pi pi-trash"
                        class="p-button-rounded p-button-text p-button-danger"
                        (click)="deleteProduct(rowData)"></button>
                </td>
            </tr>
        </ng-template>

        <ng-template pTemplate="emptymessage">
            <tr>
                <td colspan="100%">No products found.</td>
            </tr>
        </ng-template>
    </p-table>
</div>

<!-- Dialog for create/edit -->
<p-dialog header="{{ product?.id ? 'Edit Product' : 'New Product' }}" [(visible)]="productDialog" [modal]="true"
    [style]="{ width: '520px' }" [closable]="false">
    <div class="p-fluid">
        <div class="p-field">
            <label for="name">Name</label>
            <input id="name" type="text" pInputText [(ngModel)]="product.name" />
        </div>

        <div class="p-field p-grid">
            <div class="p-col-6">
                <label for="code">Code</label>
                <input id="code" type="text" pInputText [(ngModel)]="product.code" />
            </div>
            <div class="p-col-6">
                <label for="price">Price</label>
                <p-inputNumber [(ngModel)]="product.price" [mode]="'decimal'" [min]="0"></p-inputNumber>
            </div>
        </div>

        <div class="p-field p-grid">
            <div class="p-col-6">
                <label for="category">Category</label>
                <input id="category" type="text" pInputText [(ngModel)]="product.category" />
            </div>
            <div class="p-col-6">
                <label for="status">Status</label>
                <!-- Native select bound with ngModel (FormsModule) -->
                <select id="status" class="p-inputtext" [(ngModel)]="product.status" name="status">
                    <option *ngFor="let s of statuses" [value]="s.value">{{ s.label }}</option>
                </select>
            </div>
        </div>

        <div class="p-field">
            <label for="stock">Stock</label>
            <p-inputNumber [(ngModel)]="product.stock" [min]="0"></p-inputNumber>
        </div>

        <div class="p-field">
            <label for="description">Description</label>
            <textarea id="description" rows="3" pInputTextarea [(ngModel)]="product.description"></textarea>
        </div>
    </div>

    <p-footer>
        <button pButton type="button" label="Cancel" icon="pi pi-times" class="p-button-text"
            (click)="productDialog=false"></button>
        <button pButton type="button" label="Save" icon="pi pi-check" (click)="saveProduct()"></button>
    </p-footer>
</p-dialog>

<p-toast></p-toast>
<p-confirmDialog></p-confirmDialog>