<div class="min-h-screen mt-15 bg-gray-50">
    <div class="container mx-auto px-4 py-6">


        <div class="flex flex-col lg:flex-row gap-6">
            <!-- Mobile Filter Button -->
            <div class="lg:hidden">
                <p-button label="Filters" icon="pi pi-filter" (onClick)="drawerVisible = true" styleClass="w-full">
                </p-button>
            </div>

            <!-- Drawer for Mobile -->
            <p-drawer [(visible)]="drawerVisible" [style]="{ width: '85vw', 'max-width': '400px' }">
                <ng-template #header>
                    <div class="flex items-center gap-3">
                        <i class="pi pi-filter text-xl"></i>
                        <span class="text-xl font-semibold">Filters</span>
                    </div>
                </ng-template>
                <div class="space-y-6">
                    <ng-container *ngTemplateOutlet="filterContent"></ng-container>
                </div>
            </p-drawer>

            <!-- Desktop Sidebar -->
            <aside class="hidden lg:block w-64 shrink-0">
                <div class="bg-white rounded-lg shadow-sm p-6 sticky top-6">
                    <ng-container *ngTemplateOutlet="filterContent"></ng-container>
                </div>
            </aside>

            <!-- Main Content -->
            <main class="flex-1 pb-0">
                <!-- Header -->
                <div class="bg-white rounded-lg shadow-sm p-4 mb-6">
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                        <div>
                            <h1 class="text-2xl font-bold text-gray-900">{{ searchQuery() }}</h1>
                        </div>

                        <div class="flex items-center gap-4 w-full sm:w-auto">
                            <span class="text-sm text-gray-600">Sort By:</span>

                            <!-- AutoComplete as Dropdown -->
                            <p-autocomplete [(ngModel)]="selectedSort" [suggestions]="filteredSortOptions"
                                (completeMethod)="searchSort($event)" (onSelect)="onSortSelect($event)" field="label"
                                [dropdown]="true" placeholder="Best Match" styleClass="w-full sm:w-48">
                            </p-autocomplete>
                        </div>
                    </div>

                    <!-- Active Filters -->
                    @if(hasActiveFilters()){
                    <div class="mt-4 flex flex-wrap gap-2">
                        <span class="text-sm font-medium text-gray-700">Active Filters:</span>
                        <div class="flex flex-wrap gap-2">
                            <!-- Category Filter Chip -->
                            @if (selectedCategory) {
                            <span
                                class="inline-flex items-center gap-2 px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm">
                                {{ selectedCategory }}
                                <i class="pi pi-times cursor-pointer" (click)="removeCategory()"></i>
                            </span>
                            }

                            <!-- Brand Filter Chips -->
                            @for (brand of selectedBrands; track $index) {
                            <span
                                class="inline-flex items-center gap-2 px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm">
                                {{ brand }}
                                <i class="pi pi-times cursor-pointer" (click)="removeBrand(brand)"></i>
                            </span>
                            }

                            <!-- Clear All Button -->
                            <button (click)="clearAllFilters()"
                                class="text-sm text-red-600 hover:text-red-800 underline">
                                Clear All
                            </button>
                        </div>
                    </div>
                    }
                </div>

                <!-- Products Grid -->
                <div>
                    <div
                        class="w-full grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-3 sm:gap-4 mb-6">
                        @for (item of products(); track item.id) {
                        <div class="" [routerLink]="['/product', item.id, item.name]">
                            <app-producet-item [ProductItem]="item"></app-producet-item>
                        </div>
                        }
                    </div>
                </div>

                <!-- No Results -->
                @if(products()?.length === 0){
                <div class="bg-white rounded-lg shadow-sm p-12 text-center">
                    <i class="pi pi-search text-6xl text-gray-300 mb-4"></i>
                    <h3 class="text-xl font-semibold text-gray-700 mb-2">No products found</h3>
                    <p class="text-gray-500">Try adjusting your filters or search criteria</p>
                    <p-button label="Clear Filters" (onClick)="clearAllFilters()" styleClass="mt-4">
                    </p-button>
                </div>
                }


                <!-- Paginator  -->
                @if((products()?.length ?? 0) > 0) {
                <div class="flex justify-center">
                    <div class="w-full shadow-lg z-10">
                        <div class="w-full sm:container mx-auto px-2 sm:px-4">
                            <p-paginator (onPageChange)="onPageChange($event)" [first]="first" [rows]="rows"
                                [totalRecords]="totalRecords" [rowsPerPageOptions]="[5, 10, 15]" styleClass="border-0"
                                [showCurrentPageReport]="false">
                            </p-paginator>
                        </div>
                    </div>
                </div>
                }
            </main>
        </div>


    </div>


</div>

<!-- Filter Template -->
<ng-template #filterContent>
    <!-- Category Dropdown -->
    <div>
        <h3 class="text-lg font-semibold mb-3 flex text-white sm:text-black items-center gap-2">
            <i class="pi pi-list"></i>
            Category
        </h3>
        <p-select [options]="filterOptions.categories" [(ngModel)]="selectedCategory" placeholder="Select a Category"
            [editable]="true" optionLabel="name" (onChange)="onCategoryChange()" class="w-full">
        </p-select>
    </div>

    <!-- Price Range with Input Fields -->
    <div class="border-t pt-6 mt-6 text-white sm:text-black">
        <h3 class="text-lg font-semibold mb-3 flex items-center gap-2">
            Price Range
        </h3>
        <div class="space-y-3">
            <!-- Min Price Input -->
            <div>
                <label class="text-sm text-gray-600 block mb-1">Min Price (Rs.)</label>
                <p-inputnumber [(ngModel)]="minPriceInput" [min]="filterOptions.minPrice" placeholder="Min Price"
                    (onBlur)="onMinPriceChange()" styleClass="w-full" class="w-full">
                </p-inputnumber>
            </div>

            <!-- Max Price Input -->
            <div>
                <label class="text-sm text-gray-600 block mb-1">Max Price (Rs.)</label>
                <p-inputnumber [(ngModel)]="maxPriceInput" [min]="minPriceInput" placeholder="Max Price"
                    (onBlur)="onMaxPriceChange()" class="w-full">
                </p-inputnumber>
            </div>
        </div>
    </div>

    <!-- Rating Filter -->
    <div class="border-t pt-6 mt-6 text-white sm:text-black">
        <h3 class="text-lg font-semibold mb-3 flex items-center gap-2">
            <i class="pi pi-star-fill"></i>
            Rating
        </h3>
        <div class="space-y-2">
            @for (rating of [5,4,3,2,1]; track $index) {
            <div class="flex items-center cursor-pointer hover:bg-gray-50 p-2 rounded" (click)="onRatingChange(rating)">
                <input type="radio" [checked]="selectedRating === rating" name="rating" class="mr-3 w-4 h-4" />
                <p-rating [ngModel]="rating" [readonly]="true" styleClass="text-sm"> </p-rating>
                <span class="ml-2 text-sm text-gray-600">& up</span>
            </div>
            }
        </div>
    </div>

    <!-- Brand Checkboxes -->
    <div class="border-t pt-6 mt-6 text-white sm:text-black">
        <h3 class="text-lg font-semibold mb-3 flex items-center gap-2">
            <i class="pi pi-tag"></i>
            Brand
        </h3>
        <div class="space-y-2 max-h-48 overflow-y-auto">
            @for (brand of filterOptions.brands; track $index) {
            <div class="flex items-center">
                <p-checkbox [(ngModel)]="selectedBrands" [value]="brand" [inputId]="'brand-' + brand"
                    (onChange)="onBrandChange()">
                </p-checkbox>
                <label class="ml-2 text-white sm:text-black text-sm cursor-pointer">
                    {{ brand }}
                </label>
            </div>
            }
        </div>
    </div>

    <!-- Reset Button -->
    <div class="border-t pt-6 mt-6">
        <p-button label="Reset Filters" icon="pi pi-refresh" (onClick)="clearAllFilters()" severity="secondary"
            [outlined]="true" styleClass="w-full">
        </p-button>
    </div>
</ng-template>